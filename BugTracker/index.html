<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>Bug Tracker to RST</title>


<meta name="revist-after" content="2 days" />
<meta name="rating" content="General" />

<style type="text/css">
#bugsInserted{font-size:1.5em;font-weight:bold;}
#bugForm {width:100%;max-width:600px;float:left;}
#bugForm form table {width:100%;}
#bugForm form table td:first-child {width:140px;vertical-align:top;text-align:right;}
#bugForm form table textarea {width:100%;height:100px;box-sizing:border-box;}
#makeRST {width:100%;max-width:600px;float:left;margin:3px 0 0 10px;}
#makeRST #rstText {border:1px solid black;margin-top:5px;height:305px;overflow:auto;width:100%;white-space:pre;word-wrap:normal;}
</style>

<script type="text/javascript">
bugs = [];

function addBug(form){
    bugs[bugs.length] = [form.brief.value, form.steps.value, form.comments.value];
    form.reset();
    document.getElementById("bugsInserted").getElementsByTagName('span')[0].innerHTML = bugs.length;
}

function makeBorder(width){
    output = "+";
    for(var j = 0; j < width + 2; ++j){
        output += "-";
    }
    output += "+\n"
    
    return output;
}

function makeContent(content, maxWidth){
    
    if(content.length <= maxWidth - 2){
        if(content.length < maxWidth - 2){
            content += Array(maxWidth - content.length + 1 - 2).join(" ");
        }
        return ("| | " + content + " |\n");
    }
    
    
    out = "";
    if(content.length > maxWidth - 2){
        out += "| | " + content.substr(0, maxWidth - 2) + " |\n";
        out += makeContent(content.substr(maxWidth - 2), maxWidth);
    }
    
    return out;
}

function makeRST(){
    rstOut = document.getElementById('rstText');
    
    output = "";
    
    for(var i = 0; i < bugs.length; ++i){
        var width = Math.max(bugs[i][0].length, bugs[i][1].length, bugs[i][2].length, "**Steps to Reproduce:**".length);
        width = Math.min(width, 600);
        
        output += makeBorder(width);
        output += makeContent("**Issue Number:** " + (i + 1), width);
        output += makeBorder(width);
        
        output += makeContent("**Brief:**", width);
        temp = bugs[i][0].split("\n")
        for(var j = 0; j < temp.length; ++j){
            output += makeContent(temp[j], width);
        }        
        output += makeBorder(width);
        
        output += makeContent("**Steps to Reproduce:**", width);
        temp = bugs[i][1].split("\n")
        for(var j = 0; j < temp.length; ++j){
            output += makeContent(temp[j], width);
        }
        output += makeBorder(width);
        
        
        output += makeContent("**Comments:**", width);
        temp = bugs[i][2].split("\n")
        for(var j = 0; j < temp.length; ++j){
            output += makeContent(temp[j], width);
        }
        output += makeBorder(width);
        output += "\n\n";
    }
    
    rstOut.value = output;
}

</script>

</head>

<body>

<div id="bugsInserted">
<span>0</span> Bugs Added
</div>

<br /><br />

<div id="bugForm">
<form action="#" method="POST" onsubmit="addBug(this);return false;">
<table>
<tr>
    <td>Brief:</td>
    <td><textarea rows="2" cols="2" name="brief"></textarea></td>
</tr>
<tr>
    <td>Steps to Reproduce:</td>
    <td><textarea rows="2" cols="2" name="steps"></textarea></td>
</tr>
<tr>
    <td>Comments:</td>
    <td><textarea rows="2" cols="2" name="comments"></textarea></td>
</tr>
<tr>
    <td colspan="2"><input type="submit" value="Add Bug" />
</tr>

</table>
</form>
</div>

<div id="makeRST">
<button onclick="makeRST()">Generate RST</button><br />
<textarea id="rstText" readonly="readonly" rows="1" cols="1"></textarea>
</div>

</body>
</html>